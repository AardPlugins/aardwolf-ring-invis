<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE muclient>
<!-- Saved on Tuesday, September 03, 2024, 8:03 PM -->
<!-- MuClient version 5.07-pre -->

<!-- Plugin "aardwolf_ring_invis" generated by Plugin Wizard -->

<muclient>
<plugin
   name="aardwolf_ring_invis"
   author="deathr"
   id="afd8d5add184eb4630a42168"
   language="Lua"
   purpose="Automatically wear the ring of invisibilty after a fight"
   date_written="2024-09-03 20:01:28"
   requires="5.07"
   version="1.0"
   >

</plugin>

<script>
<![CDATA[
local plugin_id_gmcp_handler = "3e7dedbe37e44942dd46d264"

function OnPluginBroadcast(msg, id, name, text)
    if (id == plugin_id_gmcp_handler) then
        if (text == "char.status") then
            on_character_status_update(gmcp("char.status"))
        end
    end
end

function OnPluginInstall()
    init_plugin()
end

function OnPluginConnect()
    init_plugin()
end

function OnPluginEnable()
    init_plugin()
end

function init_plugin()
    if not IsConnected() then
        return
    end

    ColourNote("#93c47d", "", "Enabled Aardwolf Ring Invis")
    on_character_status_update(gmcp("char.status"))
end

function gmcp(s)
    local ret, datastring = CallPlugin(plugin_id_gmcp_handler, "gmcpdata_as_string", s)
    pcall(loadstring("data = " .. datastring))
    return data
end

local char_state_fighting = 8
local char_state = 0

function on_character_status_update(status)
    -- handle state changes
    local previous_state = char_state
    char_state = tonumber(status.state)

    if previous_state ~= char_state and previous_state == char_state_fighting then
        ExecuteNoEcho("wearinvis")
    end
end

function ExecuteNoEcho(cmd)
    local original_echo_setting = GetOption("display_my_input")
    SetOption("display_my_input", 0)
    Execute(cmd)
    SetOption("display_my_input", original_echo_setting)
end
]]>
</script>

</muclient>
